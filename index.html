<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Boid Algorithm Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link rel="stylesheet" href="src/css/styles.css">
</head>
<body>
    <h1>Boid Algorithm Simulation</h1>
    
    <!-- æ€§èƒ½ç›‘æ§åˆ‡æ¢æŒ‰é’® -->
    <button class="performance-toggle" onclick="togglePerformancePanel()">éšè—ç›‘æ§</button>
    
    <!-- æ€§èƒ½ç›‘æ§é¢æ¿ -->
    <div class="performance-panel" id="performancePanel">
        <h4>ğŸš€ æ€§èƒ½ç›‘æ§</h4>
        <div class="metric">
            <span class="label">å¸§ç‡ (FPS):</span>
            <span class="value" id="fps-display">0</span>
        </div>
        <div class="metric">
            <span class="label">æ´»è·ƒæ¨¡å¼:</span>
            <span class="value" id="active-mode">2D</span>
        </div>
        <div class="metric">
            <span class="label">é¸Ÿç¾¤æ•°é‡:</span>
            <span class="value" id="flock-count">0</span>
        </div>
        <div class="metric">
            <span class="label">å†…å­˜ä½¿ç”¨:</span>
            <span class="value" id="memory-usage">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="metric">
            <span class="label">æ¸²æŸ“è€—æ—¶:</span>
            <span class="value" id="render-time">0ms</span>
        </div>
        <div class="metric">
            <span class="label">ç©ºé—´ç½‘æ ¼:</span>
            <span class="value" id="spatial-cells">N/A</span>
        </div>
        <div class="metric">
            <span class="label">ä¼˜åŒ–çŠ¶æ€:</span>
            <span class="value" id="optimization-status">âœ… å·²å¯ç”¨</span>
        </div>
        
        <div class="performance-tips">
            <div class="tip" id="tip-fps">â€¢ FPSä½äº30æ—¶å»ºè®®å‡å°‘é¸Ÿç¾¤æ•°é‡</div>
            <div class="tip" id="tip-memory">â€¢ å†…å­˜ä½¿ç”¨è¿‡é«˜æ—¶è¯·åˆ·æ–°é¡µé¢</div>
            <div class="tip" id="tip-render">â€¢ æ¸²æŸ“æ—¶é—´>16mså¯èƒ½å½±å“æµç•…åº¦</div>
        </div>
    </div>
    
    <div class="tab-container">
        <div class="tabs">
            <button class="tab-button active" data-tab="2d">2D Simulation</button>
            <button class="tab-button" data-tab="3d">3D Simulation</button>
        </div>

        <!-- 2D Tab Content -->
        <div class="tab-content active" id="2d-content">
            <div class="controls">
                <div class="control-item">
                    <div class="control-header">
                        <span>Flock Size</span>
                        <span id="flockSizeValue">100</span>
                    </div>
                    <input type="range" id="flockSize" min="10" max="500" step="1" value="100">
                </div>
                <div class="control-item">
                    <div class="control-header">
                        <span>Alignment</span>
                        <span class="value">1.0</span>
                    </div>
                    <input type="range" id="alignment" min="0" max="2" step="0.1" value="1">
                </div>
                <div class="control-item">
                    <div class="control-header">
                        <span>Cohesion</span>
                        <span class="value">1.0</span>
                    </div>
                    <input type="range" id="cohesion" min="0" max="2" step="0.1" value="1">
                </div>
                <div class="control-item">
                    <div class="control-header">
                        <span>Separation</span>
                        <span class="value">1.0</span>
                    </div>
                    <input type="range" id="separation" min="0" max="2" step="0.1" value="1">
                </div>
            </div>
            <div class="canvas-container">
                <canvas id="boidCanvas"></canvas>
            </div>
        </div>

        <!-- 3D Tab Content -->
        <div class="tab-content" id="3d-content">
            <div class="controls">
                <div class="control-item">
                    <div class="control-header">
                        <span>3D Flock Size</span>
                        <span id="flockSize3DValue">100</span>
                    </div>
                    <input type="range" id="flockSize3D" min="10" max="500" step="1" value="100">
                </div>
                <div class="control-item">
                    <div class="control-header">
                        <span>3D Alignment</span>
                        <span class="value">1.0</span>
                    </div>
                    <input type="range" id="alignment3D" min="0" max="2" step="0.1" value="1">
                </div>
                <div class="control-item">
                    <div class="control-header">
                        <span>3D Cohesion</span>
                        <span class="value">1.0</span>
                    </div>
                    <input type="range" id="cohesion3D" min="0" max="2" step="0.1" value="1">
                </div>
                <div class="control-item">
                    <div class="control-header">
                        <span>3D Separation</span>
                        <span class="value">1.0</span>
                    </div>
                    <input type="range" id="separation3D" min="0" max="2" step="0.1" value="1">
                </div>
            </div>
            <div class="canvas-container">
                <canvas id="boidCanvas3D" class="canvas-3d"></canvas>
            </div>
        </div>
    </div>

    <!-- JavaScript æ¨¡å—åŠ è½½ -->
    <script src="src/js/utils/Vector3D.js"></script>
    <script src="src/js/2d/boid.js"></script>
    <script src="src/js/3d/boid3D.js"></script>
    <script src="src/js/2d/main.js"></script>
    <script src="src/js/3d/main3D.js"></script>
    <script src="src/js/utils/performance-monitor.js"></script>
    
    <script>
        // Tab switching logic
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and contents
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                button.classList.add('active');
                document.getElementById(button.dataset.tab + '-content').classList.add('active');
            });
        });
        
        // 2Då’Œ3Dæ»‘å—äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', () => {
            // 2Dæ»‘å—
            ['alignment', 'cohesion', 'separation'].forEach(id => {
                const slider = document.getElementById(id);
                if (slider) {
                    const valueElement = slider.parentElement.querySelector('.control-header .value');
                    slider.addEventListener('input', function() {
                        valueElement.textContent = parseFloat(this.value).toFixed(1);
                    });
                }
            });
            
            // 3Dæ»‘å—
            ['alignment3D', 'cohesion3D', 'separation3D'].forEach(id => {
                const slider = document.getElementById(id);
                if (slider) {
                    const valueElement = slider.parentElement.querySelector('.control-header .value');
                    slider.addEventListener('input', function() {
                        valueElement.textContent = parseFloat(this.value).toFixed(1);
                    });
                }
            });
        });
    </script>
    <script>
        // Debug code
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Checking 2D dependencies:');
            console.log('Canvas loaded:', document.getElementById('boidCanvas') !== null);
            console.log('Boid loaded:', typeof Boid !== 'undefined');
            console.log('Vector loaded:', typeof Vector !== 'undefined');
            
            console.log('Checking 3D dependencies:');
            console.log('THREE.js loaded:', typeof THREE !== 'undefined');
            console.log('OrbitControls loaded:', typeof THREE.OrbitControls !== 'undefined');
            console.log('Vector3D loaded:', typeof Vector3D !== 'undefined');
            console.log('Boid3D loaded:', typeof Boid3D !== 'undefined');
        });
    </script>
</body>
</html>
